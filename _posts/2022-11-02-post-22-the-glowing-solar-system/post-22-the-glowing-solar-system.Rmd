---
title: "Post #22. An epic ggplot journey through the glowing solar system"
description: |
  Ready for an epic ggplot journey through the glowing solar system? Let's go!   
author:
  - name: Gen-Chang Hsu
date: 2022-11-02
output:
  distill::distill_article:
    self_contained: false
categories:
  - "2022"
preview: ../../homepage_images/Post22.png
draft: true
---

<!-- Webpage style -->

<style>
d-article a {
    color: #2780e3 !important;
      border-bottom: none !important;
}

d-article a:hover {
  color: #2780e3 !important;
    border-bottom: 2px solid !important;
}

d-byline {
  margin-left: -10% !important;
}

d-title {
  margin-left: -10%;
}

d-title h1{
  font-size: 45px;
  width: 130%;
}

d-article {
  margin-left: -10%;
}

p {
  width: 120%;
}

d-article h2 {
  width: 120%;
}

d-article h3 {
  width: 120%;
  font-size: 28px;
}

div.article-footer{
  width: 120%;
}

d-article div.sourceCode { 
  width: 120% !important;
}

d-article pre { 
  width: 120% !important;
}

div.l-body {
  width: 120% !important;
}

d-article table thead tr {
  height: 60px !important;
  width: 210px !important;
}

d-article table thead th {
  height: 60px !important;
  font-size: 22px !important;
  width: 210px !important;
}

d-article table tbody tr td {
  font-size: 21px !important;
  height: 60px !important;
  text-align: center !important;
  width: 210px !important;
}

div.l-body img {
    margin-right: 20% !important;
}

</style>


```{r setup, include = FALSE}
knitr::opts_chunk$set(message = F, 
                      error = F, 
                      warning = F,
                      fig.align = "center")

```

<!-- Start of the article -->

## Background

Recently, I stumbled upon a [post](https://www.behance.net/gallery/100683383/Travelling-to-Outer-Space) by data visualization designer CÃ©dric Scherer, and I was completely blown away: I could never imagine how amazing ggplots can be (I believe you'll be in awe of it too)! Inspired by this, I hope to create my own one as well, both for fun and for learning and practicing. In fact, I think this is an excellent opportunity to bring together different data science skills: data scraping, data wrangling, and data visualization.

The rocket is about to lift off now. Take a deep breath and we are ready for our space journey!!!

## A leg-by-leg journey to the solar system

This is quite a long journey, and so I'll break it down into several legs so that we can explore the scenery in more details.

### Leg 1. Scrape the planetary data

Our first leg is to prepare the planetary data for our plot. We'll do so by scraping the information from the website and organizing it into a tidy table.

```{r, fig.width = 8, fig.height = 8, out.width = "80%"}
library(tidyverse)
library(rvest)  # for scraping the website
library(janitor)  # for the function "clean_names()"

### Read the website content 
html <- read_html("https://www.encyclopedia.com/reference/encyclopedias-almanacs-transcripts-and-maps/major-planets-solar-system-table")

### Extract and organize the table
planetary_dat <- html %>% 
  html_element("table") %>%  # find the <table> element in the content
  html_table() %>%  # parse the table into a dataframe
  slice(-c(1, 2, 4)) %>%  # remove row 1, 2, and 4
  select(where(function(x){!is.na(x) %>% any()})) %>%  # remove the columns with NAs
  `colnames<-`(.[1, ]) %>%  # set the first row as the header
  .[-1, ] %>%  # remove the first row
  mutate(across(c(2, 5, 6, 7), as.numeric)) %>%  # convert the columns to numeric
  rowid_to_column(var = "row_id") %>%  # add a row id
  clean_names() %>%  # clean the column names
  mutate(volume_earth_1 = (diameter_earth_1)^3)  # volumes of the planets relative to Earth

head(planetary_dat, 5)

```

### Leg 2. Add the url paths to the planet images

Our next leg is to add a new column to the planetary data with the url paths to the planet images. We'll use these url paths later on for our plot. 

```{r, fig.width = 8, fig.height = 8, out.width = "80%"}
library(glue)

planetary_dat <- planetary_dat %>%
  mutate(image_url = c(
    "https://scx2.b-cdn.net/gfx/news/hires/2015/whatsimporta.jpg",
    "https://cdn.britannica.com/86/21186-050-C48F8AA1/radar-clouds-Scientists-surface-Venus-computer-image.jpg",
    "https://cdn.britannica.com/25/160325-050-EB1C8FB7/image-instruments-Earth-satellite-NASA-Suomi-National-2012.jpg",
    "https://mars.nasa.gov/system/content_pages/main_images/256_Webp.net-resizeimage_%284%29.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/c/c1/Jupiter_New_Horizons.jpg",
    "https://cdn.britannica.com/80/145480-050-24BF0658/image-Hubble-Space-Telescope-Saturn-moons-shadow.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/c/c9/Uranus_as_seen_by_NASA%27s_Voyager_2_%28remastered%29_-_JPEG_converted.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/6/63/Neptune_-_Voyager_2_%2829347980845%29_flatten_crop.jpg")) %>%
  mutate(image_width = c(11.5, 12, 13, 26.5, 27, 45, 18, 16.5)) %>% 
  mutate(image_tag = glue("<img src='{image_url}' width = '{image_width}'/>"))

```

### Leg 3. Create a basic polar line chart of planets

```{r, fig.width = 8, fig.height = 8, out.width = "80%"}
library(ggblur)
library(ggforce)
library(colorspace)

P_solar_system <- ggplot() + 
  geom_point_blur(data = planetary_dat, aes(x = row_id, y = distance_from_the_sun_au,
                                            color = row_id, size = volume_earth_1,
                                            blur_size = volume_earth_1)) +
  geom_link(data = planetary_dat, aes(x = row_id, y = 0, xend = row_id, 
                                      yend = distance_from_the_sun_au,
                                      color = row_id, color = after_scale(desaturate(color, 0.3))), 
            size = 0.75, n = 300) +
  geom_point(data = planetary_dat, aes(x = row_id, y = distance_from_the_sun_au, 
                                       color = row_id, size = volume_earth_1)) + 
  scale_x_continuous(limits = c(-1, 8)) + 
  scale_y_continuous(limits = c(0, 35)) +
  guides(color = "none", size = "none", blur_size = "none") + 
  coord_polar(theta = "y", clip = "off")

P_solar_system

```

### Leg 4. Make the lines and points glow

```{r, fig.width = 8, fig.height = 8, out.width = "80%"}
library(ggthemes)

col_pal <- rev(tableau_div_gradient_pal(palette = "Sunset-Sunrise Diverging")(seq(0, 1, length = 8)))  # create a customized color palette
           
P_solar_system <- P_solar_system + 
  geom_link2(aes(x = 1:8, y = 0, xend = 2:9, yend = 0, color = 1:8), n = 100) +
  scale_color_gradientn(colors = col_pal) + 
  theme_void() + 
  theme(plot.background = element_rect(fill = "black"),
        plot.margin = margin(0, 0, 0, 0))

P_solar_system

```

### Leg 5. Add planet images

```{r, fig.width = 8, fig.height = 8, out.width = "80%"}
library(ggtext)

P_solar_system <- P_solar_system + 
    geom_richtext(data = planetary_dat, aes(x = row_id, y = distance_from_the_sun_au,
                                            label = image_tag),
                  color = NA, fill = NA,
                  nudge_x = c(0, 0, 0, 0, -0.3, -0.2, 0, 0),
                  nudge_y = c(2.4, 1.7, 1.3, 1, 1.4, 1.1, 0.7, 0.6)) +
    geom_richtext(aes(x = -1, y = 0, label = "<img src='https://res.cloudinary.com/dtpgi0zck/image/upload/s--fMAvJ-9u--/c_fit,h_580,w_860/v1/EducationHub/photos/sun-blasts-a-m66-flare.jpg' width='60'/>"), 
                  color = NA, fill = NA)

map_chr(P_solar_system$layers, function(x){class(x$geom)[1]})

library(gginnards)
P_solar_system <- move_layers(P_solar_system, "GeomRichText", position = "bottom")
P_solar_system

```

### Leg 6. Add text annotations 

```{r, fig.width = 9, fig.height = 9, out.width = "80%"}
planetary_dat <- planetary_dat %>% 
  mutate(planet_pad = ifelse(nchar(planet)%%2 == 0, 
                             str_pad(planet, width = 50, side = "both"),
                             str_pad(planet, width = 51, side = "both")))

P_solar_system + 
  geom_text(data = planetary_dat, aes(x = row_id, y = 0, color = row_id,
                                          label = glue("{planet_pad}")),
            size = 2.5, fontface = "bold", hjust = 0.7) + 
  geom_richtext(data = planetary_dat, 
      aes(
        x = 4,
        y = 20,
        label = "<b style='font-size:20pt;'>Travelling to Outer Space</b><br><br>st mission<br>"
      ),
      size = 5,
      color = NA,
      text.color = "#c0c0c0",
      lineheight = 1.5,
      hjust = 0,
      vjust = 0,
      fill = NA
    )


```
### Leg 7. Stars 



We're at the very end of the solar system. It's time to get back to Earth. 

## Summary

What a memorable journey! Hope you learn something useful from this post and don't forget to leave your comments and suggestions below if you have any!
