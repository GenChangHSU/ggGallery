---
title: "Post #19. Go with the flow - alluvial diagrams in ggplot"
description: |
  Let's create flowy alluvial diagrams in ggplot using the extension package `ggalluvial`!
author:
  - name: Gen-Chang Hsu
date: 2022-09-10
output:
  distill::distill_article:
    self_contained: false
categories:
  - "2022"
preview: ../../homepage_images/Post19.png
draft: True
---

<!-- Webpage style -->
<style>
d-article a {
    color: #2780e3 !important;
    border-bottom: none !important;
}

d-article a:hover {
    color: #2780e3 !important;
    border-bottom: 2px solid !important;
}

d-byline {
    margin-left: -10% !important;
}

d-title {
    margin-left: -10%;
}

d-title h1{
    font-size: 45px;
    width: 130%;
}

d-article {
    margin-left: -10%;
}

p {
    width: 120%;
}

d-article h2 {
    width: 120%;
}

d-article h3 {
  width: 120%;
  font-size: 28px;
}

div.article-footer{
    width: 120%;
}

d-article div.sourceCode { 
    width: 120% !important;
}

d-article pre { 
    width: 120% !important;
}

div.l-body {
    width: 120% !important;
}

div.l-body img {
    margin-right: 20% !important;
}

</style>

```{r setup, include = FALSE}
knitr::opts_chunk$set(message = F, 
                      error = F, 
                      warning = F,
                      fig.align = "center")

```

<!-- Start of the article -->

## Introduction

An alluvial diagram is a type of chart that shows the relationships between levels of categorical variables for a given quantity (number of people, amount of energy, etc.) It looks like a stacked barplot with flow streams connecting the stacks of adjacent bars (that's why it gets its name!). Alluvial diagrams are useful for visualizing pathways and trends across variables. Another similar chart is [bump charts](https://genchanghsu.github.io/ggGallery/posts/2022-08-01-post-18-bump-charts-with-ggplot/), which emphasize the change in rankings of multiple objects over time. 

## Create alluvial diagrams with `ggalluvial`

We'll be using the extension package [`ggalluvial`](https://corybrunson.github.io/ggalluvial/) to create alluvial diagrams in ggplot. The functions in `ggalluvial` can take data in both wide and long format, and we'll start with the wide format here 

First, let's prepare our data using the `diamonds` dataset:

```{r, fig.width = 9, fig.height = 5, out.width = "85%"}
library(tidyverse)


alluvial_data_diamonds <- diamonds %>% 
  mutate(price_cat = case_when(price < quantile(price, 0.33) ~ "Low",
                               price > quantile(price, 0.67) ~ "High",
                               TRUE ~ "Mid"),
         carat_cat = ifelse(carat > median(carat), "Large", "Small")) %>% 
  group_by(carat_cat, cut, color, price_cat) %>%
  summarise(count = n())


```


Now, we can use 

```{r, fig.width = 9, fig.height = 5, out.width = "85%"}
# install.packages("ggalluvial")  # install the package if you haven't
library(ggalluvial)



alluvial_data_diamonds <- diamonds %>% 
  mutate(price_cat = case_when(price < quantile(price, 0.33) ~ "Low",
                               price > quantile(price, 0.67) ~ "High",
                               TRUE ~ "Mid"),
         carat_cat = ifelse(carat > median(carat), "Large", "Small")) %>% 
  group_by(carat_cat, cut, color, price_cat) %>%
  summarise(count = n())


```


As mentioned earlier, we can also use long format for plotting. The main difference from the first approach is that now we can color the flows between adjacent strata in differently

 
```{r, fig.width = 9, fig.height = 5, out.width = "85%"}




```


## Summary





Hope you learn something useful from this post and don't forget to leave your comments and suggestions below if you have any!
