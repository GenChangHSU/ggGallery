---
title: "Post #9. Arrange multiple ggplots"
description: |
  Come and learn two ways to arrange multiple ggplots on a same page.
author:
  - name: Gen-Chang Hsu
date: 12-20-2021
output:
  distill::distill_article:
    self_contained: false
categories:
  - "2021"
preview: ../../homepage_images/Post9.png
---


<!-- Webpage style -->
<style>
d-article a {
    color: #2780e3 !important;
    border-bottom: none !important;
}

d-article a:hover {
    color: #2780e3 !important;
    border-bottom: 2px solid !important;
}

d-byline {
    margin-left: -10% !important;
}

d-title {
    margin-left: -10%;
}

d-title h1{
    font-size: 45px;
    width: 130%;
}

d-article {
    margin-left: -10%;
}

p {
    width: 120%;
}

d-article h2 {
    width: 120%;
}

d-article h3 {
  width: 120%;
  font-size: 28px;
}

div.article-footer{
    width: 120%;
}

d-article div.sourceCode { 
    width: 120% !important;
}

d-article pre { 
    width: 120% !important;
}

div.l-body {
    width: 120% !important;
}

</style>

```{r setup, include = FALSE}
knitr::opts_chunk$set(message = F, 
                      error = F, 
                      warning = F)

```

<!-- Start of the article -->

Feel excited to re-blog after taking a one-and-a-half months break. Quite shocked at my rusty writing skills. I think I really need to brush up a bit! So this time we will just do a simple post as a warm-up.


## Introduction
Sometimes we have a set of related plots and we would like to arrange them on a same page or as a single graphic. Instead of doing this manually (e.g., using MS PowerPoint), we can actually achieve the job in R. This not only streamlines the figure generation process but also makes it fully reproducible so that others can get the exact figure as yours after running your code.

In this post, I will show you two methods for layout of multiple ggplots: (1) using the function `ggarrange()` in the package [ggpubr](https://rpkgs.datanovia.com/ggpubr/index.html), and (2) using the function `draw_plot()` and its families in the package [cowplot](https://wilkelab.org/cowplot/index.html). Let's jump right in! 


## Method 1. Using `ggarrange()` in the package `ggpubr`

`ggarrange()` is a convenient function for laying out multiple plots on a same device. It also allows the users to make some adjustments, for example, adding panel labels and aligning the plots. The package also offers another function for adding text annotations to the figure. We'll go through these one by one in the following.

To begin with, let's create some plots using the famous `iris` data set:

```{r, fig.width = 5, fig.height = 3, out.width = "45%", fig.show = "hold"}
library(tidyverse)

### 1. A scatterplot of Sepal.Length vs. Sepal.Width
P1 <- ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) + 
  geom_point() + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14)

### 2. Density plot of Sepal.Length
P2 <- ggplot(iris, aes(x = Sepal.Length, color = Species)) + 
  geom_density(aes(y = ..scaled..)) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14) + 
  scale_y_continuous(breaks = seq(0, 1, 0.2))

### 3. Density plot of Sepal.Width
P3 <- ggplot(iris, aes(x = Sepal.Width, color = Species)) + 
  geom_density(aes(y = ..scaled..)) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14) + 
  scale_y_continuous(breaks = seq(0, 1, 0.2)) +
  coord_flip()
  
P1
P2
P3

```

### 1. Basic layout

Now, say, you would like to place the density plots at the top (for Sepal.Length) and right (for Sepal.Width) of the scatterplot to show their distributions. We can do this by passing the above ggplot objects (P1, P2 and P3) into `ggarrange()` and specify the layout designs (the numbers of rows and columns along with their widths and heights). 

```{r, fig.width = 6, fig.height = 6, out.width = "70%", fig.align = 'center'}
library(ggpubr)

P_arrg_1 <- ggarrange(P2 + labs(x = "", y = ""),  # remove the axis labels
                      NULL,  # you can add an empty plot using "NULL" to create a white space in the figure
                      P1, 
                      P3 + labs(x = "", y = ""), 
                      nrow = 2, 
                      ncol = 2,
                      widths = c(0.65, 0.35),  # the widths of the two columns
                      heights = c(0.35, 0.65),  # the heights of the two rows
                      common.legend = T)  # use the same legend for all plots

P_arrg_1

```

### 2. Panel labels

After getting our basic layout done, we can then add some panel labels to the plots and adjust their x and y positions: 

```{r, fig.width = 6, fig.height = 6, out.width = "70%", fig.align = 'center'}
P_arrg_2 <- ggarrange(P2 + labs(x = "", y = ""),  
                      NULL,
                      P1, 
                      P3 + labs(x = "", y = ""), 
                      nrow = 2, 
                      ncol = 2,
                      widths = c(0.65, 0.35),  
                      heights = c(0.35, 0.65),  
                      common.legend = T,
                      labels = c("(a)", "", "(b)", "(c)"),  # the panel labels for each plot (also an empty string for the "NULL" plot)
                      label.x = c(0, 0, 0, 0),  # the x positions of the labels
                      label.y = c(1.1, 1.1, 1.1, 1.1))  # the y positions of the labels

P_arrg_2

```

### 3. Text annotations

Sometimes we might want to add some text/labels to the figure. `ggpubr` provides a handy function `annotate_figure()` for this: simply create a `grob` object using `text_grob()` (you can also specify the x and y positions of the text as well as its horizontal and vertical adjustments) and pass it to the function.

```{r, fig.width = 6, fig.height = 6, out.width = "70%", fig.align = 'center'}
P_arrg_3 <- annotate_figure(P_arrg_2,
                            top = text_grob("Visualizing Iris Data", 
                                            color = "blue", 
                                            face = "bold.italic", 
                                            size = 14, 
                                            x = 0.825, 
                                            y = 1, 
                                            vjust = 10))

P_arrg_3

```

### 4. Plot alignment

Another nice functionality in `ggarrange()` is that it can automatically align the plot panels. This is particularly useful when the plots have different margin sizes (e.g., due to different label lengths). Let's take a look at an example:

```{r, fig.width = 4.5, fig.height = 4.5, out.width = "50%", fig.align = 'center'}
### A scatterplot of Sepal.Length vs. Sepal.Width
P4 <- ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) + 
  geom_point(show.legend = F) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14)

### Density plot of Sepal.Length
P5 <- ggplot(iris, aes(x = Sepal.Length, color = Species)) + 
  geom_density(aes(y = ..scaled..), show.legend = F) + 
  scale_color_brewer(palette = "Set1", name = "") +
  labs(x = NULL, y = NULL) +
  theme_classic(base_size = 14) 

### The y-axes of the two plots are not aligned by default
ggarrange(P5, 
          P4,
          nrow = 2,
          heights = c(0.3, 0.7))
```

```{r, fig.width = 4.5, fig.height = 4.5, out.width = "50%", fig.align = 'center'}
### The y-axes of the two plots are now aligned
ggarrange(P5, 
          P4,
          nrow = 2,
          heights = c(0.3, 0.7),
          align = "v")

```

<br>


## Method 2. Using `draw_plot()` in the package `cowplot` 

The package `cowplot` provides a family of functions for adding plots/images/text to the graphic device. We will see those nice features in the followings. Again, we first create some example plots:

```{r, fig.width = 5, fig.height = 3, out.width = "45%", fig.show = "hold"}
library(tidyverse)

### 1. A scatterplot of Sepal.Length vs. Sepal.Width
P1 <- ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) + 
  geom_point(show.legend = F) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14)

### 2. Density plot of Sepal.Length
P2 <- ggplot(iris, aes(x = Sepal.Length, color = Species)) + 
  geom_density(aes(y = ..scaled..)) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14) + 
  scale_y_continuous(breaks = seq(0, 1, 0.2))

### 3. Density plot of Sepal.Width
P3 <- ggplot(iris, aes(x = Sepal.Width, color = Species)) + 
  geom_density(aes(y = ..scaled..), show.legend = F) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14) + 
  scale_y_continuous(breaks = seq(0, 1, 0.2)) +
  coord_flip()
  
P1
P2
P3

```

### 1. Basic layout
In the first method `ggarrange`, you can think of it as cutting the graphic device into various grids of various widths and heights, and placing the corresponding plots into those grids.  

Here, the second method `draw_plot()`, is a bit different though. The basic idea is that, we first create a drawing canvas (using the function `ggdraw()`), which has the x- and y-coordinates of 0 to 1. Next, we use `draw_plot()` to add the objects to this canvas by specifying the x and y positions as well as their widths and heights. (Note that the x and y position in `draw_plot()` corresponds to the bottom-left corner of the plot.)

```{r, fig.width = 6, fig.height = 6, out.width = "70%", fig.align = 'center'}
library(cowplot)

ggdraw() + 
  draw_plot(P2 + labs(x = "", y = ""), x = 0, y = 0.65, width = 0.925, height = 0.3) + 
  draw_plot(P1, x = 0, y = 0, width = 0.65, height = 0.65) +
  draw_plot(P3 + labs(x = "", y = ""), x = 0.65, y = 0, width = 0.3, height = 0.65)

```
### 2. Panel labels

Let's add panel labels to the figure using the function `draw_text()`, with the same principle as `draw_plot()`:

```{r, fig.width = 6, fig.height = 6, out.width = "70%", fig.align = 'center'}
ggdraw() + 
  draw_plot(P2 + labs(x = "", y = ""), x = 0, y = 0.65, width = 0.925, height = 0.3) + 
  draw_plot(P1, x = 0, y = 0, width = 0.65, height = 0.65) +
  draw_plot(P3 + labs(x = "", y = ""), x = 0.65, y = 0, width = 0.3, height = 0.65) + 
  draw_text(c("(a)", "(b)", "(c)"), x = c(0.075, 0.075, 0.725), y = c(0.975, 0.675, 0.675)) + 
  draw_text("Visualizing Iris Data", x = 0.5, y = 0.975, color = "blue", size = 14, fontface = "italic") 

```
### 3. Add external images

Another cool thing with `cowplot` is that you can add external images to the figure, just like what you've done for the plots and text. Use `draw_image()` to achieve this (note that you need to have the package `magick` installed beforehand for this function to work):

```{r, fig.width = 6, fig.height = 6, out.width = "70%", fig.align = 'center'}
# install.packages("magick")
ggdraw() + 
  draw_plot(P2 + labs(x = "", y = ""), x = 0, y = 0.65, width = 0.925, height = 0.3) + 
  draw_plot(P1, x = 0, y = 0, width = 0.65, height = 0.65) +
  draw_plot(P3 + labs(x = "", y = ""), x = 0.65, y = 0, width = 0.3, height = 0.65) + 
  draw_text(c("(a)", "(b)", "(c)"), x = c(0.075, 0.075, 0.725), y = c(0.975, 0.675, 0.675)) + 
  draw_text("Visualizing Iris Data", x = 0.5, y = 0.975, color = "blue", size = 14, fontface = "italic") +
  draw_image("https://archive.ics.uci.edu/ml/assets/MLimages/Large53.jpg", x = 0.75, y = 0.9, width = 0.1, height = 0.1)

```
### 4. Insets and legends

We can even do some further tricks in the figure such as adding plot insets and adjusting the legend position:

```{r, fig.width = 6, fig.height = 6, out.width = "70%", fig.align = 'center'}
### 1. A scatterplot of Sepal.Length vs. Sepal.Width
P1 <- ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) + 
  geom_point(show.legend = F) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14) + 
  scale_x_continuous(limits = c(3, NA)) + 
  scale_y_continuous(limits = c(1, NA))

### 2. Density plot of Sepal.Length
P2 <- ggplot(iris, aes(x = Sepal.Length, color = Species)) + 
  geom_density(aes(y = ..scaled..), show.legend = F) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14) + 
  scale_x_continuous(limits = c(3, NA)) + 
  scale_y_continuous(breaks = seq(0, 1, 0.2))

### 3. Density plot of Sepal.Width
P3 <- ggplot(iris, aes(x = Sepal.Width, color = Species)) + 
  geom_density(aes(y = ..scaled..), show.legend = F) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14) + 
  scale_x_continuous(limits = c(1, NA)) + 
  scale_y_continuous(breaks = seq(0, 1, 0.2)) +
  coord_flip()

### 4. Extract the legend from the scatterplot
P1_legned <- ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) + 
  geom_point() + 
  scale_color_brewer(palette = "Set1", name = "") + 
  theme_classic(base_size = 14) + 
  scale_x_continuous(limits = c(3, NA)) + 
  scale_y_continuous(limits = c(1, NA))

P_legend <- get_legend(P1_legned)

### 5. Boxplot insets
P5 <- ggplot(iris, aes(x = Species, y = Sepal.Length, color = Species)) + 
  geom_boxplot(show.legend = F) + 
  scale_y_continuous(limits = c(3, NA)) + 
  scale_color_brewer(palette = "Set1", name = "") + 
  coord_flip() + 
  theme_classic(base_size = 14) + 
  scale_x_discrete(labels = c("1", "2", "3")) + 
  theme(axis.title = element_text(color = "transparent"),
        axis.text = element_text(color = "transparent"))
  

P5



### Put everything together
ggdraw() + 
  draw_plot(P2 + labs(x = "", y = ""), x = -0.025, y = 0.65, width = 0.7, height = 0.3) + 
  draw_plot(P1, x = 0, y = 0, width = 0.65, height = 0.65) +
  draw_plot(P3 + labs(x = "", y = ""), x = 0.65, y = 0, width = 0.3, height = 0.65) + 
  draw_text(c("(a)", "(b)", "(c)"), x = c(0.075, 0.075, 0.725), y = c(0.975, 0.675, 0.675)) + 
  draw_text("Visualizing Iris Data", x = 0.5, y = 0.975, color = "blue", size = 14, fontface = "italic") +
  draw_grob(P_legend, x = 0.75, y = 0.8, width = 0.1, height = 0.1) + 
  draw_image("https://archive.ics.uci.edu/ml/assets/MLimages/Large53.jpg", x = 0.75, y = 0.9, width = 0.1, height = 0.1) + 
  draw_plot(P5, x = 0, y = 0.1, width = 0.65, height = 0.15)

```

Basically, with `cowplot`, you can put anything anywhere in the figure as you wish. Perhaps the only downside is that it might take a while to experiment a bit so that the objects are at the exact positions with the sizes you want. But this also allows for much greater flexibility right?!


## Summary

<!-- To recap, we  -->

<!-- The first method, `ggarrange()` is . So if you do not have complex layout, this is -->
<!-- perhaps the go-to method -->

<!-- The second method, `draw_plot()`, allows you to arrange any plots at any positions with -->
<!-- any size. This is more flexible, but of course it might take a while to tweak the  -->
<!-- plots. So save this method for the time when you need to create a complex multiple layout plot.  -->

<!-- The most important thing is to have an idea of what your figure should look like. Perhaps draw it down on a paper. After you get an idea, yuo can then proceed and make the individual plots, and design the layout, and finally tweak the figure and do some additional decorations. -->

<!-- Hope you enjoy the reading and don't forget to leave your comments and suggestions below if you have any! -->



