---
title: "Post #31. From static to dynamicâ€”Create animations in ggplot by hand"
description: |
  Read below to see how to bring your plots alive!
author:
  - name: Gen-Chang Hsu
date: 2023-12-09
output:
  distill::distill_article:
    self_contained: false
categories:
  - "2023"
preview: ../../homepage_images/Post31.png
draft: true
---

<!-- Webpage style -->

<style>
d-article a {
  color: #2780e3 !important;
  border-bottom: none !important;
}

d-article a:hover {
  color: #2780e3 !important;
  border-bottom: 2px solid !important;
}

d-byline {
  margin-left: -10% !important;
}

d-title {
  margin-left: -10%;
}

d-title h1{
  font-size: 45px;
  width: 130%;
}

d-article {
  margin-left: -10%;
}

p {
  width: 120%;
}

d-article h2 {
  width: 120%;
}

d-article h3 {
  width: 120%;
  font-size: 28px;
}

div.article-footer{
  width: 120%;
}

d-article div.sourceCode { 
  width: 120% !important;
}

d-article pre { 
  width: 120% !important;
}

div.l-body {
  width: 120% !important;
}

d-article table thead tr {
  height: 60px !important;
  width: 210px !important;
}

d-article table thead th {
  height: 60px !important;
  font-size: 22px !important;
  width: 210px !important;
}

d-article table tbody tr td {
  font-size: 21px !important;
  height: 60px !important;
  text-align: center !important;
  width: 210px !important;
}

div.l-body img {
    margin-right: 20% !important;
}

</style>

<head>
  <base target="_blank">
</head>

```{r setup, include = FALSE}
knitr::opts_chunk$set(message = F,
                      error = F, 
                      warning = F,
                      fig.align = "center")

```

<!-- Start of the article -->

## Introduction

Animations are a power tool for data visualization and communication: They turn static images/figures into dynamic stories. If we say _a figure is worth a thousand words_, then I would argue that _an animation is worth a thousand figures_.

Creating animations in ggplot is not a daunting task: The extension package [`gganimate`](https://gganimate.com/) provides a plethora of functions to make ggplot animations and customize them. (See this [guest post](https://genchanghsu.github.io/ggGallery/posts/2021-05-26-guest-post-1-communicating-the-essence-of-your-data/) by William Ou on conveying the essence of data using `gganimate`!) But if you understand the underlying principle of animations, they are essentially an array of individual images/plots displayed in a chronological order, and we can easily make animations (for any kind of R plots) ourselves.

In this post, I'm going to show you how to make animations in ggplot by hand based on this simple principle, without the use of `gganimate` functions. I think this will make a fun coding exercise, and at the same time sharpen our programming skills. Also, a big shout-out to June Choe for his [neat post](https://yjunechoe.github.io/posts/2020-12-13-collapse-repetitive-piping-with-reduce/), which is the ultimate inspiration for this one. Enjoy!


## Create an animation in ggplot by hand

### (1) The static plot
To begin with, let's create a toy plot below: The plot consists of ten `geom_rect()` layers with successively narrower widths, and each rectangle is filled with a different color.  

```{r, fig.width = 4, fig.height = 3, out.width = "70%"}
library(tidyverse)

### The toy dataframe
df <- data.frame(xmin = 0, xmax = 0, ymin = -10, ymax = 10) 

### The color vector
color_vec <- terrain.colors(n = 10)  

### The toy plot
ggplot(df) +
  geom_rect(aes(xmin = xmin - 10^1.0, xmax = xmax + 10^1.0, ymin = ymin, ymax = ymax), fill = color_vec[10]) + 
    geom_rect(aes(xmin = xmin - 9^0.9, xmax = xmax + 9^0.9, ymin = ymin, ymax = ymax), fill = color_vec[9]) + 
    geom_rect(aes(xmin = xmin - 8^0.8, xmax = xmax + 8^0.8, ymin = ymin, ymax = ymax), fill = color_vec[8]) + 
    geom_rect(aes(xmin = xmin - 7^0.7, xmax = xmax + 7^0.7, ymin = ymin, ymax = ymax), fill = color_vec[7]) + 
    geom_rect(aes(xmin = xmin - 6^0.6, xmax = xmax + 6^0.6, ymin = ymin, ymax = ymax), fill = color_vec[6]) + 
    geom_rect(aes(xmin = xmin - 5^0.5, xmax = xmax + 5^0.5, ymin = ymin, ymax = ymax), fill = color_vec[5]) + 
    geom_rect(aes(xmin = xmin - 4^0.4, xmax = xmax + 4^0.4, ymin = ymin, ymax = ymax), fill = color_vec[4]) + 
    geom_rect(aes(xmin = xmin - 3^0.3, xmax = xmax + 3^0.3, ymin = ymin, ymax = ymax), fill = color_vec[3]) + 
    geom_rect(aes(xmin = xmin - 2^0.2, xmax = xmax + 2^0.2, ymin = ymin, ymax = ymax), fill = color_vec[2]) + 
    geom_rect(aes(xmin = xmin - 1^0.1, xmax = xmax + 1^0.1, ymin = ymin, ymax = ymax), fill = color_vec[1]) + 
    scale_x_continuous(limits = c(-10, 10)) + 
  theme_void()

```

The code looks quite like an eyesore, doesn't it? The arguments in all `geom_rect()` layers are basically the same; the only thing that changes is the supplied values. We'll fix it now.

### (2) Reduce the repetitive code
The function `reduce()`, as its name suggests, is meant to "reduce" the repetitive code by iteratively applying a function over a list/vector of values and taking the function output in the current iteration as the input for the next iteration. Sounds abstract? Let's take a look at how it actually works:

```{r, fig.width = 4, fig.height = 3, out.width = "70%"}
### Reduce the repetitive code
reduce(10:1,  # a vector of values
       .f = ~ .x + geom_rect(aes(xmin = xmin - .y^(.y/10), xmax = xmax + .y^(.y/10), ymin = ymin, ymax = ymax), fill = color_vec[.y]),  # the function to be iteratively applied
       .init = ggplot(df)  # the initial component to start the first iteration
       ) + 
  theme_void()

```

In the above code, we supplied a vector of values for the arguments in the function as well as an initial component to start the first iteration. The first iteration would be `ggplot(df) + geom_rect(aes(xmin = xmin - 10^(10/10), xmax = xmax + 10^(10/10), ymin = ymin, ymax = ymax), fill = color_vec[10])`; the second iteration would be `ggplot(df) + geom_rect(aes(xmin = xmin - 10^(10/10), xmax = xmax + 10^(10/10), ymin = ymin, ymax = ymax), fill = color_vec[10]) + geom_rect(aes(xmin = xmin - 9^(9/10), xmax = xmax + 9^(9/10), ymin = ymin, ymax = ymax), fill = color_vec[9])`, and so on and so forth. The final output was returned after the last value of the vector was completed.

### (3) A sequence of intermediate plots





### (4) Make it alive



## Summary


The bottom line is: produce a sequence of plots and stack them together in the desired order.

Hope you learn something useful from this post and don't forget to leave your comments and suggestions below if you have any!






