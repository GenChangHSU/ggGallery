---
title: "Post #27. ggplot Map Series No.3: Visualizing the veins of Taiwan in ggplots with `osmdata`"
description: |
  Create a map of the rivers and streams in Taiwan in ggplots using the package `osmdata`.
author:
  - name: Gen-Chang Hsu
date: 2023-7-31
output:
  distill::distill_article:
    self_contained: false
categories:
  - "2023"
  - "Map Series"
preview: ../../homepage_images/Post27.png
draft: true
---

<!-- Webpage style -->

<style>
d-article a {
    color: #2780e3 !important;
      border-bottom: none !important;
}

d-article a:hover {
  color: #2780e3 !important;
    border-bottom: 2px solid !important;
}

d-byline {
  margin-left: -10% !important;
}

d-title {
  margin-left: -10%;
}

d-title h1{
  font-size: 45px;
  width: 130%;
}

d-article {
  margin-left: -10%;
}

p {
  width: 120%;
}

d-article h2 {
  width: 120%;
}

d-article h3 {
  width: 120%;
  font-size: 28px;
}

div.article-footer{
  width: 120%;
}

d-article div.sourceCode { 
  width: 120% !important;
}

d-article pre { 
  width: 120% !important;
}

div.l-body {
  width: 120% !important;
}

d-article table thead tr {
  height: 60px !important;
  width: 210px !important;
}

d-article table thead th {
  height: 60px !important;
  font-size: 22px !important;
  width: 210px !important;
}

d-article table tbody tr td {
  font-size: 21px !important;
  height: 60px !important;
  text-align: center !important;
  width: 210px !important;
}

div.l-body img {
    margin-right: 20% !important;
}

</style>

```{r setup, include = FALSE}
knitr::opts_chunk$set(message = F, 
                      error = F, 
                      warning = F,
                      fig.align = "center")

```

<!-- Start of the article -->

## Introduction

[OpenStreetMap (OSM)](https://en.wikipedia.org/wiki/OpenStreetMap) is a free open global geographic database maintained by a community of volunteers and contributors. The map data in OSM contain almost every physical feature on the ground, from natural properties like mountain peaks, water bodies, and vegetation types, to human-made structures like roads, shops, and trails (see [this website](https://wiki.openstreetmap.org/wiki/Map_features) for a complete list of the map features). These data are used by a great number of websites and software apps in their maps.  

In this post, we're going to visualize the rivers and streams in Taiwan in ggplots using data in OSM. Hopefully, after reading the post, you will be able to make good use of the OSM data to create your own awesome ggplot maps!


## Create the map

Time to create the map! First, we'll prepare the river and stream data provided in OSM, and then we'll visualize them in ggplots. Finally, we'll have some fun with the map by making it artistic.

### (1) Prepare the data

The package [`osmdata`](https://cran.r-project.org/web/packages/osmdata/vignettes/osmdata.html#1_Introduction) allows users to download map data from OSM for any given area. This involves three steps:

1. Define a bounding box using the function `opq(bbox = )`. The argument "bbox" can be either a character string of the location name (e.g., `"Taipei"`), or four numerical values specifying the maximal and minimal longitudes and latitudes of the area (e.g., `c(120, 20, 120.5, 21)`).

2. Build an osmdata query using the function `add_osm_feature(key = , value = )`. The requested data are specified using "key-value" pairs, with key representing the major category of the data and the value representing the more specific feature type under that major category. 

3. Obtain OSM data with the query. The functions `osmdata_sf()` and `osmdata_sp()` will send the query to OSM, obtain the requested data, and return them in "Simple Features (sf)" and "Spatial (sp)" formats, respectively.

Let's see a worked example here:

```{r, fig.width = 6, fig.height = 3, out.width = "80%", cache = TRUE}
library(tidyverse)
library(osmdata)

### Get the boundary and county names in Taiwan 
# library(remotes)
# install_github("wmgeolab/rgeoboundaries")  # install the package if you haven't
library(rgeoboundaries)  # for the function "geoboundaries"
Taiwan_county_names <- geoboundaries("Taiwan", "adm1") %>% 
  as.tibble() %>% 
  filter(!shapeName %in% c("Matsu Islands", "Kinmen")) %>% 
  pull(shapeName)
  
### Obtain the OSM data for each county
Taiwan_water_data <- Taiwan_county_names[1:2] %>%
  map(., ~ opq(bbox = .x, timeout = 100) %>%
        add_osm_feature(key = 'waterway', value = c("stream", "river")) %>%
        osmdata_sf()) %>% 
  `names<-`(Taiwan_county_names[1:2])




```


### Create a basic map

Make a base world map using the maps package
Draw the rivers using the geom_sf() function

```{r, fig.width = 6, fig.height = 3, out.width = "80%"}

Taiwan_boundary_adm0 <- geoboundaries("Taiwan", "adm0")

ggplot() + 
  geom_sf(data = Taiwan_water_data$`Hsinchu `$osm_lines, linewidth = 0.1, fill = "blue")





```


### Make it artistic

Color the river by continent
Set the transparency by river length

```{r, fig.width = 6, fig.height = 3, out.width = "80%"}






```



## Summary



Hope you learn something useful from this post and don't forget to leave your comments and suggestions below if you have any!

