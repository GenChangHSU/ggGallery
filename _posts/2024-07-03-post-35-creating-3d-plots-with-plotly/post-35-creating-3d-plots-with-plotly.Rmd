---
title: "Post #35. Creating 3D plots with plotly and rayshader"
description: |
  Bring your plots to the next dimension with `plotly` and `rayshader`!
author:
  - name: Gen-Chang Hsu
date: 2024-07-03
output:
  distill::distill_article:
    self_contained: false
categories:
  - "2024"
preview: ../../homepage_images/Post35.png
draft: true
---

<!-- Webpage style -->

<style>
d-article a {
  color: #2780e3 !important;
  border-bottom: none !important;
}

d-article a:hover {
  color: #2780e3 !important;
  border-bottom: 2px solid !important;
}

d-byline {
  margin-left: -10% !important;
}

d-title {
  margin-left: -10%;
}

d-title h1{
  font-size: 45px;
  width: 130%;
}

d-article {
  margin-left: -10%;
}

p {
  width: 120%;
}

d-article h2 {
  width: 120%;
}

d-article h3 {
  width: 120%;
  font-size: 28px;
}

div.article-footer{
  width: 120%;
}

d-article div.sourceCode { 
  width: 120% !important;
}

d-article pre { 
  width: 120% !important;
}

div.l-body {
  width: 120% !important;
}

d-article table thead tr {
  height: 60px !important;
  width: 210px !important;
}

d-article table thead th {
  height: 60px !important;
  font-size: 22px !important;
  width: 210px !important;
}

d-article table tbody tr td {
  font-size: 21px !important;
  height: 60px !important;
  text-align: center !important;
  width: 210px !important;
}

div.l-body img {
    margin-right: 20% !important;
}

</style>

<head>
  <base target="_blank">
</head>

```{r setup, include = FALSE}
knitr::opts_chunk$set(message = F, 
                      error = F, 
                      warning = F,
                      fig.align = "center")

```

<!-- Start of the article -->

## Introduction

2D plots with an x- and a y-axis displaying the relationships between two variables are probably the most common type of plots in our everyday life. If we want to incorporate more information into the plots, we can use different appearances (colors, sizes, shapes, etc.) of points and lines (or other graphic elements). But sometimes, plotting the data in a 3D space can be more visually appealing and may even help us gain deeper insights into the data. Although ggplot does not have geoms for 3D plots by the time of this post, there are other R packages that do the job. And in this post, I'm going to introduce two of these packages to you: `plotly` and `rayshader`. They both have cool functions to generate awesome 3D plots. So buckle up and let's get ready to bring our plots to the next dimension!


## 3D plots with `plotly`

The first package we'll be using is [`plotly`](https://plotly.com/r/). The package features interactive plots and contains lots of functions for generating. The function `ggplotly()` can convert the ggplots to interactive plots. 

Here, we're going to take a look at the functions for 3D plots. We'll create a 3D scatterplot with fitted lines and a 3D surface plots with contours and a path.


### (1) 3D scatterplot


```{r, fig.width = 10, fig.height = 5, out.width = "80%"}
library(tidyverse)
library(plotly)

### Model predictions
iris_lm_prediction <- iris %>% 
  group_by(Species) %>% 
  summarise(Model = list(lm(Petal.Length ~ Sepal.Length + Sepal.Width))) %>% 
  rowwise() %>% 
  mutate(Newdata = list(data.frame(Sepal.Length = range(Model$model$Sepal.Length),
                                   Sepal.Width = range(Model$model$Sepal.Width)))) %>% 
  mutate(Prediction = list(cbind(Newdata, Prediction = predict(Model, newdata = Newdata)))) %>% 
  select(Species, Prediction) %>% 
  unnest(col = Prediction)

### Create a 3D scatterplot with the fitted lines
scatterplot3d <- plot_ly() %>% 
  # add the points
  add_markers(data = iris, 
              x = ~ Sepal.Length, 
              y = ~ Sepal.Width, 
              z = ~ Petal.Length, 
              color = ~ Species, 
              colors = c("#BF382A", "#0C4B8E", "#018571"),
              size = 2) %>% 
  # add the lines
  add_paths(data = iris_lm_prediction,
            x = ~ Sepal.Length, 
            y = ~ Sepal.Width, 
            z = ~ Prediction,
            color = ~ Species,
            colors = c("#BF382A", "#0C4B8E", "#018571"),
            showlegend = F) %>% 
  layout(legend = list(x = 0.9, y = 0.5),
         scene = list(xaxis = list(title = "Sepal length", range = list(4, 8)),
                      yaxis = list(title = "Sepal width", range = list(1, 5)),
                      zaxis = list(title = "Petal length", range = list(1, 7))))

scatterplot3d

```


### (2) 3D surface plot

```{r, fig.width = 10, fig.height = 5, out.width = "80%"}

kd <- with(MASS::geyser, MASS::kde2d(duration, waiting, n = 50))

surfaceplot3d <- plot_ly() %>%
  add_surface(x = ~ x, y = ~ y, z = ~ z, data = kd,
              contours = list(z = list(show = T,
                                       start = 0.001, 
                                       end = 0.014, 
                                       size = 0.003,
                                       usecolormap = F)
                              )
              ) %>% 
  layout(legend = list(x = 0.9, y = 0.5),
         scene = list(xaxis = list(title = "X"),
                      yaxis = list(title = "Y"),
                      zaxis = list(title = "Z")
                      )
         )


surfaceplot3d



```




### (3) Layout the plots







## 3D plots with `rayshader`







## Summary






Hope you learn something useful from this post and don't forget to leave your comments and suggestions below if you have any!






