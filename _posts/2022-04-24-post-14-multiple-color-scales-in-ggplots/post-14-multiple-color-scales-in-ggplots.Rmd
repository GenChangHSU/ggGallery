---
title: "Post #14. Multiple color scales in ggplots"
description: |
  Using different color scales for multiple geom layers with `ggnewscale` and `relayer`
author:
  - name: Gen-Chang Hsu
date: 2022-04-24
output:
  distill::distill_article:
    self_contained: false
categories:
  - "2022"
preview: ../../homepage_images/Post14.png 
draft: true
---

<!-- Webpage style -->
<style>
d-article a {
    color: #2780e3 !important;
    border-bottom: none !important;
}

d-article a:hover {
    color: #2780e3 !important;
    border-bottom: 2px solid !important;
}

d-byline {
    margin-left: -10% !important;
}

d-title {
    margin-left: -10%;
}

d-title h1{
    font-size: 45px;
    width: 130%;
}

d-article {
    margin-left: -10%;
}

p {
    width: 120%;
}

d-article h2 {
    width: 120%;
}

d-article h3 {
  width: 120%;
  font-size: 28px;
}

div.article-footer{
    width: 120%;
}

d-article div.sourceCode { 
    width: 120% !important;
}

d-article pre { 
    width: 120% !important;
}

div.l-body {
    width: 120% !important;
}

div.l-body img {
    margin-right: 20% !important;
}

</style>

```{r setup, include = FALSE}
knitr::opts_chunk$set(message = F, 
                      error = F, 
                      warning = F)

```

<!-- Start of the article -->

## The problem

Sometimes we may want to use different "color" aesthetics for multiple geom layers. Sounds abstract? To make it clear, we'll begin with an example plot:

```{r, fig.width = 5, fig.height = 3, out.width = "70%"}
library(tidyverse)

ggplot(data = iris) + 
  geom_point(aes(x = Species, y = Sepal.Length, color = Sepal.Length), position = position_jitter(width = 0.1)) + 
  geom_boxplot(aes(x = Species, y = Sepal.Length), width = 0.5, outlier.color = NA, fill = NA) + 
  labs(y = "Sepal length (cm)") + 
  theme_classic(base_size = 14) + 
  scale_color_viridis_c(name = "Sepal length")

```
Here, we make a boxplot of the sepal length for the three species and add the original data points, which are mapped to a continuous color scale.

Now, what if we want to use different colors for the boxes? Let's try it out:

```{r, fig.width = 5, fig.height = 3, out.width = "70%", error = T, warning = T, message = T, fig.show = "hide"}
ggplot(data = iris) + 
  geom_point(aes(x = Species, y = Sepal.Length, color = Sepal.Length), position = position_jitter(width = 0.1)) + 
  geom_boxplot(aes(x = Species, y = Sepal.Length, color = Species), width = 0.5, outlier.color = NA, fill = NA) +  # map species to color
  labs(y = "Sepal length (cm)") + 
  theme_classic(base_size = 14) + 
  scale_color_viridis_c(name = "Sepal length") + 
  scale_color_brewer(name = "Species", palette = "Set1")  # color scale for species

```

Eek, it throws an error!!! The message says "Continuous value supplied to discrete scale", meaning that we cannot use another color scale (the discrete one for species) when there is already one (the continuous one for sepal length). 


## The solution

Thankfully, there are extension packages designed to solve this: [`ggnewscale`](https://eliocamp.github.io/ggnewscale/) and [`relayer`](https://github.com/clauswilke/relayer). I'll walk through them in the following sections. 

### (1) ggnewscale

Looking for a quick fix? `ggnewscale` is the go-to: The main function `new_scale_color()` is super straightforward and easy to use. Simply insert the function before a new color scale (in this case `scale_color_brewer()`). This will "decouple" the previous scale from the new scale so that the new one will not interfere with the previous one. Indeed, you can apply the principle to three or more color scales! 

By the way, note that `new_scale_color()` only starts a new **scale**, not **geom**! So if you put both geom_point() and geom_boxplot() before the function, the error will still occur (you can try this yourself)!

```{r, fig.width = 5.5, fig.height = 3.5, out.width = "70%"}
# install.packages("ggnewscale")  # install the package if you haven't
library(ggnewscale)

ggplot(iris) + 
  geom_point(aes(x = Species, y = Sepal.Length, color = Sepal.Length), position = position_jitter(width = 0.1)) + 
  scale_color_viridis_c(name = "Sepal length") + 
  new_scale_color() +
  geom_boxplot(aes(x = Species, y = Sepal.Length, color = Species), width = 0.5, outlier.color = NA, fill = NA) + 
  scale_color_brewer(palette = "Set1") + 
  labs(y = "Sepal length (cm)") + 
  theme_classic(base_size = 14)

```

### (2) relayer

The second package that can deal with this situation is `relayer`.



## Summary

In this post, we learned two packages that allow us to use different color scales for multiple geom layers: `ggnewscale` is the most convenient one for simple purposes; `relayer` is slightly more complicated but at the same time more versatile.

In this post, I use color aesthetic as an example (which I think is the most common situation). But the same idea applies to other aesthetics as well: fill, linetype, etc. 

That's it for now and as always, don't forget to leave your comments and suggestions below if you have any!










