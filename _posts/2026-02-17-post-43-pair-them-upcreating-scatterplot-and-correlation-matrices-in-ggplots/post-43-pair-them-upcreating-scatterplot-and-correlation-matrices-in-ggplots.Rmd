---
title: "Post #43. Pair them upâ€”creating scatterplot matrices and correlation heatmaps in ggplots"
description: |
  In this post, you will learn how to create awesome scatterplot matrices and correlation heatmaps in ggplots using the packages `GGally` and `ggcorheatmap`!
author:
  - name: Gen-Chang Hsu
date: 2026-02-17
output:
  distill::distill_article:
    self_contained: false
categories:
  - "2026"
preview: ../../homepage_images/Post43.png
draft: true
---

<!-- Webpage style -->

<style>
d-article a {
  color: #2780e3 !important;
  border-bottom: none !important;
}

d-article a:hover {
  color: #2780e3 !important;
  border-bottom: 2px solid !important;
}

d-byline {
  margin-left: -10% !important;
}

d-title {
  margin-left: -10%;
}

d-title h1{
  font-size: 45px;
  width: 130%;
}

d-article {
  margin-left: -10%;
}

p {
  width: 120%;
}

d-article h2 {
  width: 120%;
}

d-article h3 {
  width: 120%;
  font-size: 28px;
}

div.article-footer{
  width: 120%;
}

d-article div.sourceCode { 
  width: 120% !important;
}

d-article pre { 
  width: 120% !important;
}

div.l-body {
  width: 120% !important;
}

d-article table thead tr {
  height: 60px !important;
  width: 210px !important;
}

d-article table thead th {
  height: 60px !important;
  font-size: 22px !important;
  width: 210px !important;
}

d-article table tbody tr td {
  font-size: 21px !important;
  height: 60px !important;
  text-align: center !important;
  width: 210px !important;
}

div.l-body img {
    margin-right: 30% !important;
}

</style>

<head>
  <base target="_blank">
</head>

```{r setup, include = FALSE}
knitr::opts_chunk$set(message = F, 
                      error = F, 
                      warning = F,
                      fig.align = "center")

```

<!-- Start of the article -->

## Introduction

Welcome to the first post of the year 2026! It's been over a half year since my last post, so supper happy to be back in the saddle!

Suppose you have a dataset with several variables in the columns (can be continuous, categorical, or a mix of both) and you would like to explore the bivariate relationships between the variables, then a scatterplot matrix will be really handy for this: it visualizes all pairwise combinations of variables using a range of plot types, for example, a scatterplot for two continuous variables and a boxplot for one continuous vs. one categorical variable. If you have just continuous variables in the data, you can further visualize their pairwise correlation coefficients in a correlation heatmap, which uses color for the sign of correlations and intensity for the strength of correlations. Interesting patterns will often reveal themselves!

In this post, we'll be creating scatterplot matrices in ggplots using the extension package `GGally` as well as correlation matrices/heatmaps using the extension package `ggcorrheatmap`. Let's start pairing things up!

## Part I. Create scatterplot matrices with `GGally`

### (1) Basic scatterplot matrices

```{r, fig.width = 5, fig.height = 4}
library(tidyverse)
library(GGally)
library(carData)

data("Soils")


```





## Part II. Create correlation heatmaps with `ggcorrheatmap`

In the second part of this post, we'll focus on the continuous variables in the `Soil` dataset. `ggcorrheatmap` offers a wide variety of functionality for creating correlation heatmaps. Let's start with the basics and add more complexity as we go.

### (1) Make a basic correlation heatmap
`ggcorrhm()` is the master function for creating correlation heatmaps. Simply pass your data to the function and you'll get a basic heatmap (note that he default choice of correlation is the Pearson correlation coefficient)!. We can also adjust the cell color and shape, and remove the diagonal cells (which all have a correlation coefficient of 1).

```{r, fig.width = 5, fig.height = 4}
library(ggcorrheatmap)

### Select continuous variables
Soils_continuous <- Soils %>% 
  select(is.numeric)

### Create a basic correlation heatmap
ggcorrhm(Soils_continuous)

### Change the cell color and shape
ggcorrhm(Soils_continuous,
         high = "#de2d26",  # the color for the upper limit
         mid = "white",  # the color for the midpoint
         low = "#006d2c",  # the color for the lower limit
         mode = 21,  # the shape of the cell (a number between 1 to 25)
         include_diag = F,  # remove the diagonal cells
         size_range = c(5, 10),  # the range of cell size
         layout = "bottomright",)  # show only the bottom-right trianglular matrix     

```
Looks like there are some strong positive correlations (e.g., between Na and Conductance and between N and P) and some strong negative ones (e.g., between N and Density and between P and Density). But what are the actual coefficients (and their significance)?

### (2) Create a correlation heatmap with a mixed layout

`ggcorrhm()` allows users to create correlation heatmaps with a mixed layout. To do so, we first have to tell the function that we want two triangular matrices, using the "layout" argument. We will also need to specify what we would like to display in these two triangular matrices using the "mode" argument: "heatmap" gives the colored cells, whereas "none" gives empty cells. Next, we can use the "p_values" argument to specify whether we would like to display the significance stars in each of the two triangular matrices. Finally, we can use the "cell_labels" argument to specify whether we would like to display the correlation coefficients in each of the two triangular matrices. 

```{r, fig.width = 5, fig.height = 4}
### A mixed layout with color cells and p-values
ggcorrhm(Soils_continuous,
         layout = c("topleft", "bottomright"),  # create two triangular matrices
         mode = c("heatmap", "none"),  # what to display in each of the two triangular matrices
         include_diag = T,
         p_values = c(F, T),  # whether to show the significance stars in each of two triangular matrices
         p_adjust = "none",  # can be any of the method in "p.adjust.methods"
         p_thresholds = c("***" = 0.001, "**" = 0.01, "*" = 0.05, 1),  # thresholds for annotating the significance stars
         cell_labels = c(T, F))  # whether to show the correlation coefficients in each of two triangular matrices

```
All correlation coefficients are significant (without *p*-value adjustment)!!!

### (3) Highlight certain cells in the heatmap

Now that we've learned how to make basic correlation heatmaps, we can spruce them up a bit! One thing we can do is to highlight certain cells. For example, we can highlight the borders of the cells with very strong correlations (absolute correlation coefficients larger than 0.8). 

To do so, we'll first create a basic plot and set "return_data = T". This allows us to access the data underlying the heatmap. We can then save the data as a new object and create two new columns for the cell border width and the cell border color based on the correlation coefficients. Finally, we remake the original heatmap and add a new "geom_tile()" layer where we specify our new cell border width and color.

```{r, fig.width = 5, fig.height = 4}
### Create a basic plot
p_basic <- ggcorrhm(Soils_continuous, 
                    layout = "bottomright", 
                    include_diag = F,
                    return_data = T)  # return the underlying data

### Create two new columns for the cell border width and color
p_data <- p_basic$plot_data %>% 
  mutate(border_width = if_else(abs(value) < 0.8, 0, 1),
         border_color = if_else(abs(value) < 0.8, NA, "red"))

### Add a new geom_tile() layer to the original plot
ggcorrhm(Soils_continuous, 
         layout = "bottomright", 
         include_diag = F,
         p_values = T) + 
  geom_tile(data = p_data,
            aes(x = col, y = row),
            fill = NA,
            linewidth = p_data$border_width,  # new cell border width 
            color = p_data$border_color)  # new cell border color

```

### (4) Cluster the variables and annotate the heatmap


```{r, fig.width = 5, fig.height = 4}
### Data for highlighting the cell borders
p_basic <- ggcorrhm(Soils_continuous, 
                    layout = "topright", 
                    include_diag = F,
                    return_data = T)

p_data <- p_basic$plot_data %>% 
  mutate(border_width = if_else(abs(value) < 0.8, 0, 1),
         border_color = if_else(abs(value) < 0.8, NA, "#fed976"))

### Create a dataframe for annotation
annotation_df <- data.frame(.names = colnames(Soils_continuous),
                            Type = c("Non-element", "Element", "Non-element", 
                                     "Element", "Element", "Element",
                                     "Element", "Element", "Non-element"))

### Cluster the variables in the heatmap
ggcorrhm(Soils_continuous, 
         layout = "topright", 
         include_diag = T,
         high = "#e34a33",
         mid = "white",
         low = "#006d2c",
         p_values = T,
         cluster_rows = T,  # cluster the rows  
         cluster_cols = T,  # cluster the columns
         show_dend_cols = F,  # hide the row dendrogram 
         annot_rows_df = annotation_df,
         annot_rows_names_side = "top",
         show_annot_names = F,
         annot_dist = 0.3) +   
  geom_tile(data = p_data,
            aes(x = col, y = row),
            fill = NA,
            linewidth = p_data$border_width,
            color = p_data$border_color) + 
  theme(legend.position = "inside",
        legend.position.inside = c(0.1, 0.3))
  
```



## Summary




Hope you learn something useful from this post and don't forget to leave your comments and suggestions below if you have any!

